
<!doctype html>
<html lang="az">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Telegram Quiz Idar?etm?</title>
<style>
body { font-family: system-ui, sans-serif; max-width: 720px; margin: 0 auto; padding: 24px; }
.row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
input { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; }
button { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; }
.primary { background: #2563eb; color: #fff; }
.secondary { background: #e5e7eb; }
.status { margin-top: 8px; color: #475569; min-height: 20px; }
</style>
</head>
<body>
<h1>Telegram Quiz Idar?etm?</h1>
<div class="row">
  <div>
    <label>Bot Token</label>
    <input id="tg_token" placeholder="TELEGRAM_BOT_TOKEN">
  </div>
  <div>
    <label>Kanal ID</label>
    <input id="tg_channel" placeholder="@kanal_adi v? ya ID">
  </div>
</div>
<button class="secondary" id="saveBtn">Konfiqurasiyani saxla</button>
<div class="status" id="saveStatus"></div>
<hr style="margin: 20px 0;">
<div class="row">
  <div>
    <label>Quiz sual sayi</label>
    <input id="q_count" type="number" value="30">
  </div>
  <div style="display:flex; align-items:flex-end;">
    <button class="primary" id="startBtn">Quiz-i Baslat</button>
  </div>
</div>
<div class="status" id="startStatus"></div>
<script>
const saveBtn = document.getElementById('saveBtn');
const startBtn = document.getElementById('startBtn');
const saveStatus = document.getElementById('saveStatus');
const startStatus = document.getElementById('startStatus');
saveBtn.onclick = async () => {
  saveStatus.textContent = 'Yükl?nir...';
  try {
    const token = document.getElementById('tg_token').value.trim();
    const channelId = document.getElementById('tg_channel').value.trim();
    const resp = await fetch('/api/admin/telegram-config', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token, channelId })
    });
    const data = await resp.json();
    if (data && data.success) {
      saveStatus.textContent = 'Saxlandi.';
    } else {
      saveStatus.textContent = 'X?ta: ' + (data.message || 'Nam?lum');
    }
  } catch (e) {
    saveStatus.textContent = 'X?ta: ' + e.message;
  }
};
startBtn.onclick = async () => {
  startStatus.textContent = 'Yükl?nir...';
  try {
    const count = parseInt(document.getElementById('q_count').value || '30', 10);
    const resp = await fetch('/api/telegram/start-quiz', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ count })
    });
    const data = await resp.json();
    if (data && data.success) {
      startStatus.textContent = data.message || 'Basladi.';
    } else {
      startStatus.textContent = 'X?ta: ' + (data.message || 'Nam?lum');
    }
  } catch (e) {
    startStatus.textContent = 'X?ta: ' + e.message;
  }
};
</script>
</body>
</html>
